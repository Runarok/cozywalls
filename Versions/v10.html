<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozywalls | Wallpaper Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap');

        :root {
            --bg-deep: #0a0b12;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent: #3b82f6;
            --sidebar-w: 280px;
            --sidebar-collapsed-w: 4px;
        }

        body {
            background: radial-gradient(circle at top left, #1a1b2e, #0a0b12);
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        /* Sidebar logic */
        #sidebar {
            width: var(--sidebar-w);
            transform: translateX(calc(-100% + var(--sidebar-collapsed-w)));
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 50;
        }

        /* Mouse trigger zone - Enhanced for discovery */
        #sidebar::after {
            content: '';
            position: absolute;
            right: -40px;
            top: 0;
            bottom: 0;
            width: 40px;
        }

        #sidebar:hover {
            transform: translateX(0);
        }

        #sidebar .nav-label {
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }

        #sidebar:hover .nav-label {
            opacity: 1;
        }

        /* Added Tutorial Overlay styles */
        #tutorial {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #tutorial.active {
            display: flex;
            opacity: 1;
        }

        .tutorial-content {
            background: rgba(10, 11, 18, 0.8);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Tooltip style */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%) translateX(-10px);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
            z-index: 60;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(0);
        }

        @media (max-width: 768px) {
            .tooltip::after { display: none; }
        }

        /* Grid Item */
        .wp-item {
            transition: all 0.5s ease;
            cursor: zoom-in;
        }

        .wp-item:hover {
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .wp-item img {
            opacity: 0.7;
            transition: all 0.7s ease;
        }

        .wp-item:hover img {
            opacity: 1;
            transform: scale(1.05);
        }

        /* Modal */
        #modal {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #modal.active {
            display: flex;
            opacity: 1;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.9);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        /* Grid adjustments for better spacing */
        #grid {
            padding-left: 20px;
            transition: padding 0.4s ease;
        }

        @media (min-width: 1024px) {
            #grid {
                padding-left: 40px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Tutorial Overlay -->
    <div id="tutorial" class="fixed inset-0 z-[200] flex items-center justify-center p-6">
        <div class="tutorial-content max-w-md w-full p-10 rounded-[2rem] text-center space-y-8 shadow-2xl">
            <div class="space-y-4">
                <h2 class="text-4xl font-extralight tracking-tight text-white/90 italic">Discovery Awaits</h2>
                <p class="text-white/40 font-light leading-relaxed">
                    Hover your cursor near the <span class="text-blue-400 font-medium">left edge</span> of the screen to reveal hidden controls and collection tools.
                </p>
            </div>
            <button id="close-tutorial" class="w-full py-4 glass rounded-2xl text-sm uppercase tracking-[0.2em] font-medium text-white/60 hover:text-white hover:bg-white/10 transition-all">
                Enter Gallery
            </button>
        </div>
    </div>

    <!-- Overlay (for mobile/tablet discovery) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 opacity-0 pointer-events-none z-40 transition-opacity duration-500"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full glass z-50 p-6 flex flex-col gap-12 shadow-2xl">
        <div class="space-y-1">
            <h1 class="text-3xl font-light tracking-tight text-white/90 italic">Cozywalls</h1>
            <p class="text-[10px] uppercase tracking-widest text-white/40 font-medium">Gallery Experience</p>
        </div>

        <div class="space-y-8">
            <div class="space-y-3">
                <div class="flex justify-between text-xs">
                    <span class="text-white/40 uppercase tracking-wider">Collection</span>
                    <span id="count-total" class="text-white/80">0</span>
                </div>
                <div class="flex justify-between text-xs">
                    <span class="text-white/40 uppercase tracking-wider">Status</span>
                    <span class="text-blue-400 font-medium">Live Sync</span>
                </div>
            </div>

            <nav class="flex flex-col gap-2">
                <button class="tooltip w-full flex items-center gap-6 px-4 py-3 rounded-xl text-white/60 hover:text-white hover:bg-white/5 transition-all group" data-tip="Switch to Grid Layout">
                    <i class="fas fa-th-large text-blue-500 w-5 text-center group-hover:scale-110 transition-transform"></i>
                    <span class="nav-label text-sm font-light tracking-wide">Grid View</span>
                </button>
                <button id="refresh-btn" class="tooltip w-full flex items-center gap-6 px-4 py-3 rounded-xl text-white/60 hover:text-white hover:bg-white/5 transition-all group" data-tip="Fetch Latest Wallpapers">
                    <i class="fas fa-sync-alt text-blue-500 w-5 text-center group-hover:scale-110 transition-transform"></i>
                    <span class="nav-label text-sm font-light tracking-wide">Refresh</span>
                </button>
                <button id="download-all-btn" class="tooltip w-full flex items-center gap-6 px-4 py-3 rounded-xl text-white/60 hover:text-white hover:bg-white/5 transition-all group" data-tip="Download Collection">
                    <i class="fas fa-download text-blue-500 w-5 text-center group-hover:scale-110 transition-transform"></i>
                    <span class="nav-label text-sm font-light tracking-wide">Download All</span>
                </button>
            </nav>
        </div>

        <!-- Footer -->
        <div class="mt-auto pt-8 border-t border-white/5 space-y-4">
            <div class="space-y-2">
                <a href="https://github.com/Runarok/cozywalls" target="_blank" class="flex items-center gap-3 text-[10px] text-white/40 hover:text-white/80 transition-colors uppercase tracking-widest group">
                    <i class="fab fa-github text-sm group-hover:scale-110 transition-transform"></i>
                    <span>Repo Hosted</span>
                </a>
                <a href="https://github.com/leanghok120/cozywalls" target="_blank" class="flex items-center gap-3 text-[10px] text-white/40 hover:text-white/80 transition-colors uppercase tracking-widest group">
                    <i class="fas fa-code-branch text-sm group-hover:scale-110 transition-transform"></i>
                    <span>Fork of Original</span>
                </a>
            </div>
            <div class="opacity-30 text-[9px] uppercase tracking-[0.3em]">
                Curated Minimalist Spaces
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="p-6 md:p-12 lg:p-16">
        <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Images will be injected here -->
        </div>
    </main>

    <!-- Modal Viewer -->
    <div id="modal" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-3xl flex flex-col items-center justify-center p-6 md:p-12">
        <button id="close-modal" class="absolute top-8 right-8 text-white/30 hover:text-white transition-colors p-2 text-2xl">
            <i class="fas fa-times"></i>
        </button>

        <div class="relative w-full max-w-6xl aspect-video flex items-center justify-center">
            <img id="modal-img" src="/placeholder.svg" alt="Wallpaper" class="w-full h-full object-contain shadow-2xl rounded-sm">
            
            <!-- Arrows -->
            <button id="prev-btn" class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-16 md:-translate-x-24 text-white/20 hover:text-white transition-all hover:scale-110 text-5xl font-thin">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="next-btn" class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-16 md:translate-x-24 text-white/20 hover:text-white transition-all hover:scale-110 text-5xl font-thin">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Controls -->
        <div class="mt-12 flex items-center gap-6 px-8 py-3 glass rounded-full">
            <button id="modal-prev" class="control-btn p-3 rounded-full text-white/60 hover:text-white"><i class="fas fa-chevron-left"></i></button>
            <div class="w-px h-6 bg-white/10"></div>
            <button id="shuffle-btn" class="control-btn p-3 rounded-full text-white/60 hover:text-white"><i class="fas fa-random"></i></button>
            <div class="w-px h-6 bg-white/10"></div>
            <button id="download-btn" class="control-btn p-3 rounded-full text-white/60 hover:text-white"><i class="fas fa-arrow-down"></i></button>
            <div class="w-px h-6 bg-white/10"></div>
            <button id="modal-next" class="control-btn p-3 rounded-full text-white/60 hover:text-white"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div id="modal-info" class="mt-8 text-white/30 text-[10px] uppercase tracking-[0.2em] font-light">
            Loading...
        </div>
    </div>

    <script>
        // Configuration
        const REPO_OWNER = 'Runarok';
        const REPO_NAME = 'cozywalls';
        const FOLDER_PATH = 'Cozywalls';
        const RAW_BASE_URL = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/master/${FOLDER_PATH}/`;

        let wallpapers = [];
        let currentIndex = 0;

        // Elements
        const grid = document.getElementById('grid');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const tutorial = document.getElementById('tutorial');
        const closeTutorial = document.getElementById('close-tutorial');
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modal-img');
        const countTotal = document.getElementById('count-total');
        const modalInfo = document.getElementById('modal-info');

        function checkTutorial() {
            const hasSeenTutorial = localStorage.getItem('cozywalls_onboarded');
            if (!hasSeenTutorial) {
                tutorial.classList.add('active');
            }
        }

        closeTutorial.onclick = () => {
            tutorial.classList.remove('active');
            localStorage.setItem('cozywalls_onboarded', 'true');
            // Small delay to remove from DOM display
            setTimeout(() => tutorial.style.display = 'none', 500);
        };

        sidebar.onmouseenter = () => {
            overlay.classList.add('opacity-100', 'pointer-events-auto');
        };

        sidebar.onmouseleave = () => {
            overlay.classList.remove('opacity-100', 'pointer-events-auto');
        };

        // Initial Fetch
        async function fetchWallpapers() {
            try {
                // Fetching from GitHub API to list folder contents
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FOLDER_PATH}`);
                const data = await response.json();
                
                wallpapers = data
                    .filter(file => file.type === 'file' && (file.name.endsWith('.jpg') || file.name.endsWith('.png') || file.name.endsWith('.webp') || file.name.endsWith('.jpeg')))
                    .map(file => ({
                        name: file.name,
                        url: file.download_url
                    }));

                countTotal.innerText = wallpapers.length;
                renderGrid();
            } catch (error) {
                console.error('Error fetching wallpapers:', error);
                // Fallback to placeholder if API fails
                wallpapers = Array.from({length: 12}).map((_, i) => ({
                    name: `Sample Wallpaper ${i+1}.jpg`,
                    url: `https://images.unsplash.com/photo-${1500000000000 + i}?auto=format&fit=crop&w=1920&q=80`
                }));
                renderGrid();
            }
        }

        function renderGrid() {
            grid.innerHTML = '';
            wallpapers.forEach((wp, index) => {
                const item = document.createElement('div');
                item.className = 'wp-item group relative aspect-video glass overflow-hidden rounded-xl';
                item.innerHTML = `
                    <img src="${wp.url}" alt="${wp.name}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-end p-5">
                        <span class="text-[10px] uppercase tracking-widest text-white/70 font-light">${wp.name}</span>
                    </div>
                `;
                item.onclick = () => openModal(index);
                grid.appendChild(item);
            });
        }

        function openModal(index) {
            currentIndex = index;
            modalImg.src = wallpapers[currentIndex].url;
            modalInfo.innerText = `${currentIndex + 1} / ${wallpapers.length} â€” ${wallpapers[currentIndex].name}`;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function navigate(dir) {
            if (dir === 'next') currentIndex = (currentIndex + 1) % wallpapers.length;
            else currentIndex = (currentIndex - 1 + wallpapers.length) % wallpapers.length;
            openModal(currentIndex);
        }

        function shuffle() {
            let next;
            do { next = Math.floor(Math.random() * wallpapers.length); } while (next === currentIndex);
            openModal(next);
        }

        // Download All Functionality
        async function downloadAll() {
            const btn = document.getElementById('download-all-btn');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin text-blue-500 w-5"></i><span class="nav-label text-sm font-light">Zipping...</span>';
            btn.disabled = true;

            try {
                const zip = new JSZip();
                const folder = zip.folder("cozywalls");

                const promises = wallpapers.map(async (wp) => {
                    const response = await fetch(wp.url);
                    const blob = await response.blob();
                    folder.file(wp.name, blob);
                });

                await Promise.all(promises);
                const content = await zip.generateAsync({ type: "blob" });
                saveAs(content, "cozywalls-collection.zip");
            } catch (error) {
                console.error("[v0] Download all failed:", error);
                alert("Failed to download collection. Check console for details.");
            } finally {
                btn.innerHTML = originalHtml;
                btn.disabled = false;
            }
        }

        // Event Listeners
        document.getElementById('close-modal').onclick = closeModal;
        document.getElementById('next-btn').onclick = () => navigate('next');
        document.getElementById('prev-btn').onclick = () => navigate('prev');
        document.getElementById('modal-next').onclick = () => navigate('next');
        document.getElementById('modal-prev').onclick = () => navigate('prev');
        document.getElementById('shuffle-btn').onclick = shuffle;
        document.getElementById('refresh-btn').onclick = fetchWallpapers;
        document.getElementById('download-btn').onclick = () => {
            const link = document.createElement('a');
            link.href = wallpapers[currentIndex].url;
            link.download = wallpapers[currentIndex].name;
            link.click();
        };
        document.getElementById('download-all-btn').onclick = downloadAll;

        window.onclick = (e) => { if (e.target === modal) closeModal(); };
        
        window.onkeydown = (e) => {
            if (!modal.classList.contains('active')) return;
            if (e.key === 'ArrowRight') navigate('next');
            if (e.key === 'ArrowLeft') navigate('prev');
            if (e.key === 'Escape') closeModal();
        };

        // Init
        checkTutorial();
        fetchWallpapers();
    </script>
</body>
</html>
